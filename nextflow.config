params {
    // Input/output
    metadata = null
    outdir = 'results'
    
    // Reference data
    index_dir = "${projectDir}/reference/star_index"
    whitelist_dir = "${projectDir}/reference/whitelists"
    
    // Computing resources
    max_memory = '128.GB'
    max_cpus = 32
    max_time = '48.h'
}

// Process resource configuration
process {
    // Default settings
    cpus = 4
    memory = '8.GB'
    time = '4.h'
    
    withName: DOWNLOAD_DATA {
        cpus = 4
        memory = '8.GB'
        time = '24.h'
        maxRetries = 3
        errorStrategy = { task.attempt <= 3 ? 'retry' : 'finish' }
    }
    
    withName: MAP_READS {
        cpus = params.max_cpus
        memory = { 64.GB * task.attempt }
        time = params.max_time
        maxRetries = 3
        errorStrategy = { task.attempt <= 3 ? 'retry' : 'finish' }
    }
}

// Execution reports
report {
    enabled = true
    file = "${params.outdir}/execution_report.html"
    overwrite = true
}

timeline {
    enabled = true
    file = "${params.outdir}/timeline.html"
    overwrite = true
}

trace {
    enabled = true
    file = "${params.outdir}/trace.txt"
    overwrite = true
    fields = ['task_id', 'hash', 'process', 'tag', 'status', 'exit', 'start', 'complete', 'duration', 'realtime', 'cpus', '%cpu', 'memory', '%mem', 'rss', 'vmem', 'peak_rss', 'peak_vmem', 'rchar', 'wchar']
}

dag {
    enabled = true
    file = "${params.outdir}/dag.svg"
    overwrite = true
}